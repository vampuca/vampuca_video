<!doctype html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Моя видео-презентация</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reset.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reveal.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/theme/black.min.css" id="theme">
	<style>
		.reveal .slide-background-content {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		
		/* Адаптивное видео для мобильных */
		@media (max-width: 768px) {
			.reveal .slide-background-content,
			.reveal .slide-background-content video {
				object-fit: contain !important;
				width: 100% !important;
				height: 100% !important;
			}
			
			.reveal .slide-background {
				background-color: black !important;
			}
			
			.reveal .slides {
				width: 100% !important;
				height: 100% !important;
			}
			
			.reveal .slides section {
				width: 100% !important;
				height: 100% !important;
			}
			
			/* Принудительно применяем contain к видео */
			.reveal .backgrounds .slide-background video {
				object-fit: contain !important;
				object-position: center !important;
			}
		}
		.reveal .controls .navigate-left,
		.reveal .controls .navigate-right {
			color: white;
			opacity: 0.7;
		}
		.reveal .controls .navigate-left {
			position: fixed;
			left: 20px;
			bottom: 20px;
			right: auto;
		}
		.reveal .controls .navigate-right {
			position: fixed;
			right: 20px;
			bottom: 20px;
			left: auto;
		}
		#player-controls {
			position: fixed;
			left: 50%;
			bottom: 20px;
			transform: translateX(-50%);
			z-index: 100;
			cursor: pointer;
			opacity: 0.7;
			display: none;
		}
		#player-controls:hover {
			opacity: 1;
		}
		#icon-play {
			display: none;
		}

		/* Кнопка полноэкранного режима */
		#fullscreen-btn {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 100;
			cursor: pointer;
			opacity: 0.7;
			display: none;
		}
		#fullscreen-btn:hover {
			opacity: 1;
		}
		#fullscreen-btn svg {
			width: 24px;
			height: 24px;
		}

		/* Новые, более надежные стили для мобильных устройств */
		@media (max-width: 768px) {
			.reveal .controls .navigate-left {
				left: 10px !important;
				bottom: 10px !important;
			}
			.reveal .controls .navigate-right {
				right: 10px !important;
				bottom: 10px !important;
			}
			#player-controls {
				bottom: 15px !important;
			}
			#player-controls svg {
				width: 28px !important;
				height: 28px !important;
			}
			#fullscreen-btn {
				top: 15px !important;
				right: 15px !important;
				display: block !important;
			}
			#fullscreen-btn svg {
				width: 28px !important;
				height: 28px !important;
			}
		}

		/* Подсветка стрелки на первом слайде для мобильных */
		.mobile-highlight .reveal .controls .navigate-right {
			animation: pulse 2s infinite;
			opacity: 1 !important;
		}
		
		@keyframes pulse {
			0% { transform: scale(1); }
			50% { transform: scale(1.2); }
			100% { transform: scale(1); }
		}
	</style>
</head>
<body>

	<div id="fullscreen-btn">
		<svg id="icon-fullscreen" width="24" height="24" viewBox="0 0 100 100">
			<path d="M25 25 L25 40 M25 25 L40 25 M75 25 L75 40 M75 25 L60 25 M25 75 L25 60 M25 75 L40 75 M75 75 L75 60 M75 75 L60 75" stroke="white" stroke-width="4" fill="none" stroke-linecap="round"/>
		</svg>
		<svg id="icon-exit-fullscreen" width="24" height="24" viewBox="0 0 100 100" style="display: none;">
			<path d="M40 40 L40 25 M40 40 L25 40 M60 40 L60 25 M60 40 L75 40 M40 60 L40 75 M40 60 L25 60 M60 60 L60 75 M60 60 L75 60" stroke="white" stroke-width="4" fill="none" stroke-linecap="round"/>
		</svg>
	</div>
	<div id="player-controls">
		<svg id="icon-pause" width="32" height="32" viewBox="0 0 100 100">
			<path d="M30 20 L30 80 M70 20 L70 80" stroke="white" stroke-width="12" fill="none" stroke-linecap="round"/>
		</svg>
		<svg id="icon-play" width="32" height="32" viewBox="0 0 100 100">
			<path d="M35 20 L35 80 L75 50 Z" stroke="white" stroke-width="12" fill="white" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>
	</div>
	<div class="reveal">
		<div class="slides">
			<section data-background-video="KLKT_title.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_1.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_2.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_3.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_4.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_5.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_6.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_7.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_8.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_9.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_10.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_11.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_12.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_13.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_14.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_15.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_16.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_17.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_18.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_19.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_end.m4v" data-background-video-loop="true" data-autoplay></section>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reveal.min.js"></script>
	<script>
		let currentVideo = null;
		let isUnlocked = false;
		const playerControls = document.getElementById('player-controls');
		const iconPause = document.getElementById('icon-pause');
		const iconPlay = document.getElementById('icon-play');
		const fullscreenBtn = document.getElementById('fullscreen-btn');
		const iconFullscreen = document.getElementById('icon-fullscreen');
		const iconExitFullscreen = document.getElementById('icon-exit-fullscreen');

		// Определяем мобильное устройство
		function isMobile() {
			return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
		}

		// Подсвечиваем стрелку для мобильных устройств
		if (isMobile()) {
			document.body.classList.add('mobile-highlight');
		}

		// Функции для полноэкранного режима
		function toggleFullscreen() {
			if (!document.fullscreenElement) {
				document.documentElement.requestFullscreen().catch(err => {
					console.log('Fullscreen failed:', err);
				});
			} else {
				document.exitFullscreen();
			}
		}

		function updateFullscreenIcon() {
			if (document.fullscreenElement) {
				iconFullscreen.style.display = 'none';
				iconExitFullscreen.style.display = 'block';
			} else {
				iconFullscreen.style.display = 'block';
				iconExitFullscreen.style.display = 'none';
			}
		}

		// Слушатели для полноэкранного режима
		document.addEventListener('fullscreenchange', updateFullscreenIcon);
		fullscreenBtn.addEventListener('click', toggleFullscreen);

		function showPauseIcon() {
			iconPause.style.display = 'block';
			iconPlay.style.display = 'none';
		}

		function showPlayIcon() {
			iconPause.style.display = 'none';
			iconPlay.style.display = 'block';
		}

		function togglePause() {
			if (currentVideo) {
				if (currentVideo.paused) {
					currentVideo.play();
				} else {
					currentVideo.pause();
				}
			}
		}

		// Функция для принудительного запуска видео
		function forcePlayVideo(video) {
			if (video && isUnlocked) {
				video.muted = false;
				video.play().catch(err => {
					console.log('Autoplay failed, trying muted:', err);
					video.muted = true;
					video.play();
				});
			}
		}

		// Функция для применения мобильных стилей к видео
		function applyMobileVideoStyles() {
			if (isMobile()) {
				const videos = document.querySelectorAll('.reveal .slide-background video');
				videos.forEach(video => {
					video.style.objectFit = 'contain';
					video.style.objectPosition = 'center';
					video.style.width = '100%';
					video.style.height = '100%';
				});
			}
		}

		Reveal.initialize({
			history: false, 
			transition: 'fade',
			controls: true,
			touch: true,
			keyboard: {
				32: togglePause,
				70: toggleFullscreen  // F для полноэкранного режима
			}
		});

		function updateCurrentVideo() {
			const indices = Reveal.getIndices();
			const isFirstSlide = (indices.h === 0 && indices.v === 0);
			
			playerControls.style.display = isFirstSlide ? 'none' : 'block';

			const currentSlide = Reveal.getCurrentSlide();
			const background = Reveal.getSlideBackground(currentSlide);
			
			if (currentVideo) {
				currentVideo.removeEventListener('play', showPauseIcon);
				currentVideo.removeEventListener('pause', showPlayIcon);
			}

			currentVideo = background ? background.querySelector('video') : null;
			
			if (currentVideo) {
				currentVideo.addEventListener('play', showPauseIcon);
				currentVideo.addEventListener('pause', showPlayIcon);
				
				// Принудительно запускаем видео для мобильных
				if (isMobile() && isUnlocked) {
					setTimeout(() => forcePlayVideo(currentVideo), 100);
				}
				
				if (currentVideo.paused) {
					showPlayIcon();
				} else {
					showPauseIcon();
				}
			}
			
			// Убираем подсветку стрелки после первого слайда
			if (!isFirstSlide && isMobile()) {
				document.body.classList.remove('mobile-highlight');
			}
			
			// Применяем мобильные стили к видео
			applyMobileVideoStyles();
		}

		// Обработчик для разблокировки звука при переходе со первого слайда
		Reveal.on('slidechanged', function(event) {
			if (isMobile() && !isUnlocked && event.previousSlide && event.indexh === 1) {
				isUnlocked = true;
				document.body.classList.remove('mobile-highlight');
				
				// Запускаем текущее видео
				if (currentVideo) {
					forcePlayVideo(currentVideo);
				}
			}
			updateCurrentVideo();
		});

		Reveal.on('ready', function() {
			updateCurrentVideo();
			applyMobileVideoStyles();
		});

		playerControls.addEventListener('click', togglePause);

		// Дополнительная обработка свайпов для мобильных
		if (isMobile()) {
			let startX = 0;
			let startY = 0;
			let threshold = 50;

			document.addEventListener('touchstart', function(e) {
				startX = e.touches[0].clientX;
				startY = e.touches[0].clientY;
			});

			document.addEventListener('touchend', function(e) {
				if (!startX || !startY) return;

				let endX = e.changedTouches[0].clientX;
				let endY = e.changedTouches[0].clientY;

				let diffX = startX - endX;
				let diffY = startY - endY;

				// Проверяем, что это горизонтальный свайп
				if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > threshold) {
					if (diffX > 0) {
						// Свайп влево - следующий слайд
						Reveal.next();
					} else {
						// Свайп вправо - предыдущий слайд
						Reveal.prev();
					}
				}

				startX = 0;
				startY = 0;
			});
		}
	</script>
</body>
</html>