<!doctype html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Моя видео-презентация</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reset.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reveal.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/theme/black.min.css" id="theme">
	<style>
		.reveal .slide-background-content {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		.reveal .controls .navigate-left,
		.reveal .controls .navigate-right {
			color: white;
			opacity: 0.7;
		}
		.reveal .controls .navigate-left {
			position: fixed;
			left: 20px;
			bottom: 20px;
			right: auto;
		}
		.reveal .controls .navigate-right {
			position: fixed;
			right: 20px;
			bottom: 20px;
			left: auto;
		}
		#player-controls {
			position: fixed;
			left: 50%;
			bottom: 20px;
			transform: translateX(-50%);
			z-index: 100;
			cursor: pointer;
			opacity: 0.7;
			display: none;
		}
		#player-controls:hover {
			opacity: 1;
		}
		#icon-play {
			display: none;
		}

		/* Новые, более надежные стили для мобильных устройств */
		@media (max-width: 768px) {
			.reveal .controls .navigate-left {
				left: 10px !important;
				bottom: 10px !important;
			}
			.reveal .controls .navigate-right {
				right: 10px !important;
				bottom: 10px !important;
			}
			#player-controls {
				bottom: 15px !important;
			}
			#player-controls svg {
				width: 28px !important;
				height: 28px !important;
			}
		}

		/* Подсветка стрелки на первом слайде для мобильных */
		.mobile-highlight .reveal .controls .navigate-right {
			animation: pulse 2s infinite;
			opacity: 1 !important;
		}
		
		@keyframes pulse {
			0% { transform: scale(1); }
			50% { transform: scale(1.2); }
			100% { transform: scale(1); }
		}
	</style>
</head>
<body>

	<div id="player-controls">
		<svg id="icon-pause" width="32" height="32" viewBox="0 0 100 100">
			<path d="M30 20 L30 80 M70 20 L70 80" stroke="white" stroke-width="12" fill="none" stroke-linecap="round"/>
		</svg>
		<svg id="icon-play" width="32" height="32" viewBox="0 0 100 100">
			<path d="M35 20 L35 80 L75 50 Z" stroke="white" stroke-width="12" fill="white" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>
	</div>
	<div class="reveal">
		<div class="slides">
			<section data-background-video="KLKT_title.m4v" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_1.mp4" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_2.mp4" data-background-video-loop="true" data-autoplay></section>
			<section data-background-video="KLKT_3.mp4" data-background-video-loop="true" data-autoplay></section>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.6.1/reveal.min.js"></script>
	<script>
		let currentVideo = null;
		let isUnlocked = false;
		const playerControls = document.getElementById('player-controls');
		const iconPause = document.getElementById('icon-pause');
		const iconPlay = document.getElementById('icon-play');

		// Определяем мобильное устройство
		function isMobile() {
			return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
		}

		// Подсвечиваем стрелку для мобильных устройств
		if (isMobile()) {
			document.body.classList.add('mobile-highlight');
		}

		function showPauseIcon() {
			iconPause.style.display = 'block';
			iconPlay.style.display = 'none';
		}

		function showPlayIcon() {
			iconPause.style.display = 'none';
			iconPlay.style.display = 'block';
		}

		function togglePause() {
			if (currentVideo) {
				if (currentVideo.paused) {
					currentVideo.play();
				} else {
					currentVideo.pause();
				}
			}
		}

		// Функция для принудительного запуска видео
		function forcePlayVideo(video) {
			if (video && isUnlocked) {
				video.muted = false;
				video.play().catch(err => {
					console.log('Autoplay failed, trying muted:', err);
					video.muted = true;
					video.play();
				});
			}
		}

		Reveal.initialize({
			history: false, 
			transition: 'fade',
			controls: true,
			touch: true,
			keyboard: {
				32: togglePause
			}
		});

		function updateCurrentVideo() {
			const indices = Reveal.getIndices();
			const isFirstSlide = (indices.h === 0 && indices.v === 0);
			
			playerControls.style.display = isFirstSlide ? 'none' : 'block';

			const currentSlide = Reveal.getCurrentSlide();
			const background = Reveal.getSlideBackground(currentSlide);
			
			if (currentVideo) {
				currentVideo.removeEventListener('play', showPauseIcon);
				currentVideo.removeEventListener('pause', showPlayIcon);
			}

			currentVideo = background ? background.querySelector('video') : null;
			
			if (currentVideo) {
				currentVideo.addEventListener('play', showPauseIcon);
				currentVideo.addEventListener('pause', showPlayIcon);
				
				// Принудительно запускаем видео для мобильных
				if (isMobile() && isUnlocked) {
					setTimeout(() => forcePlayVideo(currentVideo), 100);
				}
				
				if (currentVideo.paused) {
					showPlayIcon();
				} else {
					showPauseIcon();
				}
			}
			
			// Убираем подсветку стрелки после первого слайда
			if (!isFirstSlide && isMobile()) {
				document.body.classList.remove('mobile-highlight');
			}
		}

		// Обработчик для разблокировки звука при переходе со первого слайда
		Reveal.on('slidechanged', function(event) {
			if (isMobile() && !isUnlocked && event.previousSlide && event.indexh === 1) {
				isUnlocked = true;
				document.body.classList.remove('mobile-highlight');
				
				// Запускаем текущее видео
				if (currentVideo) {
					forcePlayVideo(currentVideo);
				}
			}
			updateCurrentVideo();
		});

		Reveal.on('ready', updateCurrentVideo);

		playerControls.addEventListener('click', togglePause);
	</script>
</body>
</html>